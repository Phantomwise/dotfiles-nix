#!/usr/bin/env bash

# AI Disclaimer:
# This script was generated by AI.

count=0
while IFS= read -r -d '' f; do
  # Remove the leading ./ if present (since find outputs relative paths)
  f="${f#./}"
  truncated_f="${f:0:50}"
  [ ${#f} -gt 50 ] && truncated_f="${truncated_f}..."
  info=$(ffprobe -v quiet -print_format json -show_streams "$f" | jq -r '.streams | map("\u001b[36m\(.index)\u001b[0m: \u001b[36m\(.codec_type)\u001b[0m: language=\u001b[34m\(.tags.LANGUAGE // .tags.language // "none")\u001b[0m language_ietf=\u001b[35m\(.tags.LANGUAGE_IETF // .tags.language_ietf // "none")\u001b[0m") | join("\t")')
  echo -e "$info\t$truncated_f"
  count=$((count + 1))
done < <(find . -maxdepth 1 \( -name "*.mkv" -o -name "*.webm" -o -name "*.mp4" -o -name "*.m4a" -o -name "*.m4v" \) -print0)
echo "Total items: $count"
